{% extends 'configq_base_template.html' %}

{% block title %}
	<title>Page config</title>
{% endblock %}

{% block content %}
	<div class="row">
		<div class="col-md-8">
			<h4> Page config </h4>			
			<p>Exam: {{ exam }}, Page number: {{ page_number }}</p>
			<div class="form-group">
				<form action="{% url 'configq:question_config' %}" method="post">
				    {% csrf_token %}
				    <table>{{ form.as_table }}</table>
		    		<input type="submit" value="Submit">
				</form>
				<button type="button" class="btn btn-light" id="draw_rect" onclick = "draw_rect()">Visualize selection</button>
			</div>		
		</div>
	</div>

	<div class="row question-image" id="question-image">	
		<img src="/media/{{ image_url }}" alt="question image" height="1754" width="1240" id="myimage">	
	</div>
	<div id="canvas-div" style="border: 2px solid red">
		<canvas id="canvas" height="1754" width="1240"></canvas>	
	</div>	
	
	<script type="text/javascript">
		var last_element_clicked

		function element_clicked(e){
			last_element_clicked = e.srcElement.id
		}

		function draw_rect() {


			// console.log('clicked');
			var image = document.getElementById("myimage");
			var canvas = document.getElementById('canvas');
		
			// if(image.style.display === 'none'){
			// 	image.style.display = 'block';
			// 	canvas.style.display = 'none';
			// }else{
			// 	image.style.display = 'none';
			// 	canvas.style.style = 'block';
				
			// 	if (canvas.getContext) {
				    var context = canvas.getContext('2d');		   
				    context.drawImage(image, 10, 10, 3508, 2480);
				    
			// 	}
			// }
			
			
		}

		function MouseTrack(e) {   
			parentX = document.getElementById('question-image').offsetLeft
			parentY = document.getElementById('question-image').offsetTop
        	var Xcoord = (e.pageX-parentX)*2
           	var Ycoord = (e.pageY-parentY)*2 
           	// console.log(parentX, parentY)
           
           	if (last_element_clicked === 'id_mat_digit_1_top_left_x' || last_element_clicked === 'id_mat_digit_1_top_left_y'){
           		document.getElementById('id_mat_digit_1_top_left_x').value = Xcoord;
           		document.getElementById('id_mat_digit_1_top_left_y').value = Ycoord;
           	}else if(last_element_clicked === 'id_mat_digit_1_bottom_right_x' || last_element_clicked === 'id_mat_digit_1_bottom_right_y'){
           		document.getElementById('id_mat_digit_1_bottom_right_x').value = Xcoord;
           		document.getElementById('id_mat_digit_1_bottom_right_y').value = Ycoord;
           	}else if (last_element_clicked === 'id_mat_digit_2_top_left_x' || last_element_clicked === 'id_mat_digit_2_top_left_y'){
           		document.getElementById('id_mat_digit_2_top_left_x').value = Xcoord;
           		document.getElementById('id_mat_digit_2_top_left_y').value = Ycoord;
           	}else if(last_element_clicked === 'id_mat_digit_2_bottom_right_x' || last_element_clicked === 'id_mat_digit_2_bottom_right_y'){
           		document.getElementById('id_mat_digit_2_bottom_right_x').value = Xcoord;
           		document.getElementById('id_mat_digit_2_bottom_right_y').value = Ycoord;
           	}else if (last_element_clicked === 'id_mat_digit_3_top_left_x' || last_element_clicked === 'id_mat_digit_3_top_left_y'){
           		document.getElementById('id_mat_digit_3_top_left_x').value = Xcoord;
           		document.getElementById('id_mat_digit_3_top_left_y').value = Ycoord;
           	}else if(last_element_clicked === 'id_mat_digit_3_bottom_right_x' || last_element_clicked === 'id_mat_digit_3_bottom_right_y'){
           		document.getElementById('id_mat_digit_3_bottom_right_x').value = Xcoord;
           		document.getElementById('id_mat_digit_3_bottom_right_y').value = Ycoord;
           	}else if (last_element_clicked === 'id_mat_digit_4_top_left_x' || last_element_clicked === 'id_mat_digit_4_top_left_y'){
           		document.getElementById('id_mat_digit_4_top_left_x').value = Xcoord;
           		document.getElementById('id_mat_digit_4_top_left_y').value = Ycoord;
           	}else if(last_element_clicked === 'id_mat_digit_4_bottom_right_x' || last_element_clicked === 'id_mat_digit_4_bottom_right_y'){
           		document.getElementById('id_mat_digit_4_bottom_right_x').value = Xcoord;
           		document.getElementById('id_mat_digit_4_bottom_right_y').value = Ycoord;
           	}else if (last_element_clicked === 'id_mat_digit_5_top_left_x' || last_element_clicked === 'id_mat_digit_5_top_left_y'){
           		document.getElementById('id_mat_digit_5_top_left_x').value = Xcoord;
           		document.getElementById('id_mat_digit_5_top_left_y').value = Ycoord;
           	}else if(last_element_clicked === 'id_mat_digit_5_bottom_right_x' || last_element_clicked === 'id_mat_digit_5_bottom_right_y'){
           		document.getElementById('id_mat_digit_5_bottom_right_x').value = Xcoord;
           		document.getElementById('id_mat_digit_5_bottom_right_y').value = Ycoord;
           	}else if (last_element_clicked === 'id_mat_digit_6_top_left_x' || last_element_clicked === 'id_mat_digit_6_top_left_y'){
           		document.getElementById('id_mat_digit_6_top_left_x').value = Xcoord;
           		document.getElementById('id_mat_digit_6_top_left_y').value = Ycoord;
           	}else if(last_element_clicked === 'id_mat_digit_6_bottom_right_x' || last_element_clicked === 'id_mat_digit_6_bottom_right_y'){
           		document.getElementById('id_mat_digit_6_bottom_right_x').value = Xcoord;
           		document.getElementById('id_mat_digit_6_bottom_right_y').value = Ycoord;
           	}else if (last_element_clicked === 'id_mat_digit_7_top_left_x' || last_element_clicked === 'id_mat_digit_7_top_left_y'){
           		document.getElementById('id_mat_digit_7_top_left_x').value = Xcoord;
           		document.getElementById('id_mat_digit_7_top_left_y').value = Ycoord;
           	}else if(last_element_clicked === 'id_mat_digit_7_bottom_right_x' || last_element_clicked === 'id_mat_digit_7_bottom_right_y'){
           		document.getElementById('id_mat_digit_7_bottom_right_x').value = Xcoord;
           		document.getElementById('id_mat_digit_7_bottom_right_y').value = Ycoord;
           	}else if (last_element_clicked === 'id_page_no_top_left_x' || last_element_clicked === 'id_page_no_top_left_y'){
           		document.getElementById('id_page_no_top_left_x').value = Xcoord;
           		document.getElementById('id_page_no_top_left_y').value = Ycoord;
           	}else if(last_element_clicked === 'id_page_no_bottom_right_x' || last_element_clicked === 'id_page_no_bottom_right_y'){
           		document.getElementById('id_page_no_bottom_right_x').value = Xcoord;
           		document.getElementById('id_page_no_bottom_right_y').value = Ycoord;
           	}           
        }        
        window.addEventListener("DOMContentLoaded", function(event){
        	
			document.getElementById('id_mat_digit_1_top_left_x').addEventListener("click", element_clicked);
			document.getElementById('id_mat_digit_1_top_left_x').addEventListener("click", element_clicked);
			document.getElementById('id_mat_digit_1_bottom_right_x').addEventListener("click", element_clicked);
			document.getElementById('id_mat_digit_1_bottom_right_y').addEventListener("click", element_clicked);
			document.getElementById('id_mat_digit_2_top_left_x').addEventListener("click", element_clicked);
			document.getElementById('id_mat_digit_2_top_left_x').addEventListener("click", element_clicked);
			document.getElementById('id_mat_digit_2_bottom_right_x').addEventListener("click", element_clicked);
			document.getElementById('id_mat_digit_2_bottom_right_y').addEventListener("click", element_clicked);
			document.getElementById('id_mat_digit_3_top_left_x').addEventListener("click", element_clicked);
			document.getElementById('id_mat_digit_3_top_left_x').addEventListener("click", element_clicked);
			document.getElementById('id_mat_digit_3_bottom_right_x').addEventListener("click", element_clicked);
			document.getElementById('id_mat_digit_3_bottom_right_y').addEventListener("click", element_clicked);
			document.getElementById('id_mat_digit_4_top_left_x').addEventListener("click", element_clicked);
			document.getElementById('id_mat_digit_4_top_left_x').addEventListener("click", element_clicked);
			document.getElementById('id_mat_digit_4_bottom_right_x').addEventListener("click", element_clicked);
			document.getElementById('id_mat_digit_4_bottom_right_y').addEventListener("click", element_clicked);
			document.getElementById('id_mat_digit_5_top_left_x').addEventListener("click", element_clicked);
			document.getElementById('id_mat_digit_5_top_left_x').addEventListener("click", element_clicked);
			document.getElementById('id_mat_digit_5_bottom_right_x').addEventListener("click", element_clicked);
			document.getElementById('id_mat_digit_5_bottom_right_y').addEventListener("click", element_clicked);
			document.getElementById('id_mat_digit_6_top_left_x').addEventListener("click", element_clicked);
			document.getElementById('id_mat_digit_6_top_left_x').addEventListener("click", element_clicked);
			document.getElementById('id_mat_digit_6_bottom_right_x').addEventListener("click", element_clicked);
			document.getElementById('id_mat_digit_6_bottom_right_y').addEventListener("click", element_clicked);
			document.getElementById('id_mat_digit_7_top_left_x').addEventListener("click", element_clicked);
			document.getElementById('id_mat_digit_7_top_left_x').addEventListener("click", element_clicked);
			document.getElementById('id_mat_digit_7_bottom_right_x').addEventListener("click", element_clicked);
			document.getElementById('id_mat_digit_7_bottom_right_y').addEventListener("click", element_clicked);
			document.getElementById('id_page_no_top_left_x').addEventListener("click", element_clicked);
			document.getElementById('id_page_no_top_left_y').addEventListener("click", element_clicked);
			document.getElementById('id_page_no_bottom_right_x').addEventListener("click", element_clicked);
			document.getElementById('id_page_no_bottom_right_y').addEventListener("click", element_clicked);
			document.querySelector('#question-image').addEventListener('click' , MouseTrack);
			// document.querySelector('#draw_rect').addEventListener('click' , draw_rect);
		});
	</script>
{% endblock %}